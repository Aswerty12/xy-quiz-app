<div class="max-w-4xl mx-auto p-6 bg-white shadow-lg rounded-lg mt-10 mb-10">

    <!-- HEADER -->
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Create New Quiz</h2>

    <!-- UPLOAD FORM -->
    <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" class="space-y-6">

        <!-- Metadata Inputs -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Quiz Name</label>
                <input type="text" formControlName="name"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2"
                    placeholder="e.g. Real vs AI" />
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Label X Name</label>
                <input type="text" formControlName="labelX"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2"
                    placeholder="e.g. Real Photo" />
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Label Y Name</label>
                <input type="text" formControlName="labelY"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2"
                    placeholder="e.g. AI Generated" />
            </div>
        </div>

        <!-- Drag and Drop Zones -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-6">
            <!-- Zone X -->
            <div class="flex flex-col gap-2">
                <span class="font-semibold text-gray-600">
                    Upload Images for "{{ uploadForm.get('labelX')?.value || 'Label X' }}" (Zip)
                </span>
                <div appDragDrop (fileDropped)="onFileSelected($event, 'x')"
                    class="relative h-32 flex flex-col items-center justify-center border-4 border-dashed rounded-lg transition-colors cursor-pointer bg-gray-50">
                    <div *ngIf="!fileX" class="text-center p-2">
                        <p class="text-gray-500 text-sm">Drag & Drop ZIP here</p>
                    </div>
                    <div *ngIf="fileX" class="text-center p-2">
                        <p class="text-green-600 font-bold text-sm">Selected:</p>
                        <p class="text-xs text-gray-700 break-all">{{ fileX.name }}</p>
                    </div>
                    <input type="file" (change)="onManualSelect($event, 'x')" accept=".zip"
                        class="opacity-0 absolute w-full h-full cursor-pointer" />
                </div>
            </div>

            <!-- Zone Y -->
            <div class="flex flex-col gap-2">
                <span class="font-semibold text-gray-600">
                    Upload Images for "{{ uploadForm.get('labelY')?.value || 'Label Y' }}" (Zip)
                </span>
                <div appDragDrop (fileDropped)="onFileSelected($event, 'y')"
                    class="relative h-32 flex flex-col items-center justify-center border-4 border-dashed rounded-lg transition-colors cursor-pointer bg-gray-50">
                    <div *ngIf="!fileY" class="text-center p-2">
                        <p class="text-gray-500 text-sm">Drag & Drop ZIP here</p>
                    </div>
                    <div *ngIf="fileY" class="text-center p-2">
                        <p class="text-green-600 font-bold text-sm">Selected:</p>
                        <p class="text-xs text-gray-700 break-all">{{ fileY.name }}</p>
                    </div>
                    <input type="file" (change)="onManualSelect($event, 'y')" accept=".zip"
                        class="opacity-0 absolute w-full h-full cursor-pointer" />
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div *ngIf="isUploading" class="w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 mt-4">
            <div class="bg-blue-600 h-4 rounded-full transition-all duration-300" [style.width.%]="uploadProgress">
            </div>
        </div>

        <!-- Messages -->
        <div *ngIf="errorMessage" class="p-3 bg-red-100 text-red-700 rounded text-sm">{{ errorMessage }}</div>
        <div *ngIf="successMessage" class="p-3 bg-green-100 text-green-700 rounded text-sm">{{ successMessage }}</div>

        <!-- Upload Button -->
        <div class="flex justify-end pt-4">
            <button type="submit" [disabled]="uploadForm.invalid || !fileX || !fileY || isUploading"
                class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50">
                {{ isUploading ? 'Uploading...' : 'Create Quiz' }}
            </button>
        </div>
    </form>

    <!-- MANAGE QUIZZES SECTION -->
    <hr class="my-8 border-gray-200">

    <div class="space-y-4">
        <h3 class="text-xl font-bold text-gray-800">Manage Existing Quizzes</h3>

        <div *ngIf="isLoadingList" class="text-gray-500 text-sm">Loading quizzes...</div>
        <div *ngIf="!isLoadingList && quizzes.length === 0" class="text-gray-400 italic text-sm">No quizzes found.</div>

        <div *ngFor="let quiz of quizzes"
            class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div>
                <h4 class="font-bold text-gray-800">{{ quiz.name }}</h4>
                <p class="text-xs text-gray-500">
                    {{ quiz.total_images }} images â€¢ {{ quiz.created_at | date:'shortDate' }}
                </p>
                <p class="text-xs text-gray-400">
                    Labels: {{ quiz.label_x }} / {{ quiz.label_y }}
                </p>
            </div>
            <button (click)="onDeleteQuiz(quiz.id)" [disabled]="deletingQuizId === quiz.id"
                class="px-3 py-1 bg-red-100 text-red-600 hover:bg-red-200 disabled:bg-gray-100 disabled:text-gray-400 rounded text-sm font-medium transition-colors">
                {{ deletingQuizId === quiz.id ? 'Deleting...' : 'Delete' }}
            </button>
        </div>
    </div>

</div>